<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="./css/element-index.css">
    <script src="./js/vue.js"></script>
    <script src="./js/axios.min.js"></script>
    <script src="./js/element-index.js"></script>
</head>
<body>
<div id="app">
    <el-container style="justify-content: center; align-items: center; text-align: center; padding: 20px;">
        <el-col :span="24">
            <div class="grid-content bg-purple-light" style="display: flex; justify-content: center; align-items: center;">
                <el-col :span="3" style="margin-right: 20px;">
                    <el-input size="medium" v-model="account" placeholder="Search by account"></el-input>
                </el-col>
                <el-col :span="3" style="margin-right: 20px;">
                    <el-select size="medium" v-model="did" placeholder="Search by department">
                        <el-option
                                v-for="item in options"
                                :key="item.id"
                                :label="item.name"
                                :value="item.id">
                        </el-option>
                    </el-select>
                </el-col>
                <el-col :span="3" style="margin-right: 20px;">
                    <el-select size="medium" v-model="pid" placeholder="Search by Position">
                        <el-option
                                v-for="item in options2"
                                :key="item.id"
                                :label="item.name"
                                :value="item.id">
                        </el-option>
                    </el-select>
                </el-col>
                <el-col :span="3" style="margin-right: 20px;">
                    <el-input
                            size="medium"
                            placeholder="Search by gender"
                            suffix-icon="el-icon-user"
                            v-model="sex">
                    </el-input>
                </el-col>
                <el-col :span="3" style="margin-right: 20px;">
                    <el-date-picker
                            size="medium"
                            v-model="birthday"
                            type="date"
                            value-format="yyyy-MM-dd"
                            placeholder="Search by birtyday">
                    </el-date-picker>
                </el-col>
                <el-button
                        style="margin-left: 20px;"
                        type="primary"
                        size="medium"
                        icon="el-icon-search"
                        @click="search()">Search</el-button>
                <el-button size="medium" icon="el-icon-refresh-right" @click="reset()">Reset</el-button>
            </div>
        </el-col>
    </el-container>
    <el-container class="custom-container">
        <el-main class="custom-main">
            <div>
                <el-row class="custom-row">
                    <el-col>
                        <el-button type="primary" icon="el-icon-plus" size="medium" @click="outerVisible = true" class="custom-button">Add user</el-button>
                        <el-upload action="http://localhost:8060/excel/upload" :show-file-list="false" :on-success="handleUploadSuccess2" class="custom-upload">
                            <el-button icon="el-icon-upload2" size="medium">Import</el-button>
                        </el-upload>
                        <download-excel class="export-excel-wrapper custom-export" :data="officeleavelist" name="请假申请表.xls">
                            <el-button icon="el-icon-download" size="medium">Derive</el-button>
                        </download-excel>
                        <el-popover placement="top" width="160" v-model="visible" class="custom-popover">
                            <p>选择排序规则</p>
                            <div style="text-align: right; margin: 0">
                                <el-button size="medium" type="primary" style="margin-top: 10px;" @click="findBy('beginDate')">按开始时间</el-button>
                                <el-button size="medium" type="primary" style="margin-top: 10px;" @click="findBy('summitDate')">按提交时间</el-button>
                                <el-button size="medium" type="primary" style="margin-top: 10px;" @click="findBy('orderStatus')">按审批状态</el-button>
                                <el-button size="medium" type="primary" style="margin-top: 10px;" @click="findBy('submitter')">按提交人员</el-button>
                            </div>
                            <el-button slot="reference" icon="el-icon-s-data" size="medium">排序</el-button>
                        </el-popover>
                        <el-button icon="el-icon-s-grid" size="medium" class="custom-list">列表</el-button>
                    </el-col>
                </el-row>
                <el-row class="custom-row">
                    <el-table :stripe="true" :border="true" style="width: 100%" ref="multipleTable" :data="userList" tooltip-effect="dark" @selection-change="handleSelectionChange">
                        <el-table-column type="selection" width="55"></el-table-column>
                        <el-table-column prop="company" label="Account" width="130">
                            <template slot-scope="scope">
                                <span>{{scope.row.account}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column label="Email" show-overflow-tooltip width="210">
                            <template slot-scope="scope">
                                <span>{{scope.row.email}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column label="Department" show-overflow-tooltip width="210">
                            <template slot-scope="scope">
                                <span>{{scope.row.did}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column label="Position" show-overflow-tooltip width="210">
                            <template slot-scope="scope">
                                <span>{{scope.row.pid}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column label="Gender" show-overflow-tooltip width="100">
                            <template slot-scope="scope">
                                <span>{{scope.row.sex}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column label="Birthday" show-overflow-tooltip width="140">
                            <template slot-scope="scope">
                                <span>{{scope.row.birthday}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column label="Phone" show-overflow-tooltip width="160">
                            <template slot-scope="scope">
                                <span>{{scope.row.phone}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column label="Wechat" show-overflow-tooltip width="160">
                            <template slot-scope="scope">
                                <span>{{scope.row.wechat}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column label="Operation" show-overflow-tooltip width="160">
                            <template slot-scope="scope">
                                <span>
                                    <el-button type="text" size="small" icon="el-icon-arrow-right" @click="details(scope)">Modify</el-button>
                                    <el-button type="text" size="small" icon="el-icon-delete-solid" @click="appear(scope)">Delete</el-button>
                                </span>
                            </template>
                        </el-table-column>
                    </el-table>
                </el-row>
            </div>
            <el-row>
                <el-pagination @size-change="handleSizeChange" @current-change="handleCurrentChange" :current-page="currentPage" :page-sizes="[10,20,30]" :page-size="pagesize" layout="prev, pager, next, jumper, sizes, total" :total="total">
                </el-pagination>
            </el-row>
        </el-main>
    </el-container>
</div>

</body>
<script>
    new Vue({
        el: '#app',
        data() {
            return {
                json_meta: [
                    [
                        {
                            " key ": " charset ",
                            " value ": " utf- 8 "
                        }
                    ]
                ],
                visible: false,
                userList:
                    [{
                        id: "",
                        account: "",
                        email: "",
                        did: "",
                        pid: "",
                        sex: "",
                        birthday: "",
                        phone: "",
                        wechat: "",
                        zip: ""
                    }],
                officeleavelist2:
                    [{
                        id: "",
                        type: "",
                        reason: "",
                        beginDate: "",
                        endDate: "",
                        days: "",
                        summitDate: "",
                        orderStatus: "",
                        submitter: "",
                        approver: "",
                        approverTime: "",
                        relatedBusiness: "",
                        businessType: "",
                        notifyPerson: "",
                        approvalType: "",
                        zip: ""
                    }]
                ,
                pagesize: 10, // 当前页大小
                total: 100, // 总条数
                currentPage: 1, // 当前页
                multipleSelection: [],
                options: [{
                    id: "1", status: "富冈义勇"
                }],
                options2: [{
                    id: "1", type: "我妻善逸"
                }],
                options3: [{
                    id: "1", type: "灶门碳治郎"
                }],
                options4: [{
                    id: "1", name: "嘴平伊之助"
                }],
                options5: [{
                    id: "1", name: "栗花落香奈乎"
                }],
                options6: [{
                    id: "1", level: "宇髓天元"
                }],
                value: '',
                id: '',
                account: "",
                did: "",
                pid: "",
                sex: "",
                birthday: "",
                outerVisible: false,
                innerVisible1: false,
                innerVisible2: false,
                innerVisible3: false,
                innerVisible4: false,
                innerVisible5: false,
                delid: 1,
                fullscreenLoading: false,
                ruleForm: {
                    type: "",
                    days: "",
                    reason: '',
                    beginDate: "",
                    relatedBusiness: "",
                    businessType: "",
                    approver: "",
                    notifyPerson: [],
                    delivery: false,
                    zip: ""
                },
                ruleForm2: {
                    days: "",
                    beginDate: "",
                    address: "",
                    fee: "",
                    reason: "",
                    relatedBusiness: "",
                    businessType: "",
                    approver: "",
                    notifyPerson: [],
                    delivery: false,
                },
                ruleForm3: {
                    loanAmount: "",
                    loanReason: "",
                    relatedBusiness: "",
                    businessType: "",
                    approver: "",
                    notifyPerson: [],
                    delivery: false,
                },
                ruleForm4: {
                    visitCustomer: "",
                    visitReason: "",
                    visitTime: "",
                    relatedBusiness: "",
                    approver: "",
                    notifyPerson: [],
                    delivery: false,
                },
                ruleForm5: {
                    emergency: "",
                    requestContent: "",
                    relatedBusiness: "",
                    businessType: "",
                    approver: "",
                    notifyPerson: [],
                    delivery: false,
                },
                dialogVisible: false,
                rules: {
                    days: [
                        {required: true, message: '请输入请假天数', trigger: 'blur'},
                        {type: 'number', message: '天数必须为数字值'}
                    ],
                    type: [
                        {required: true, message: '请选择请假类型', trigger: 'change'}
                    ],
                    beginDate: [
                        {type: 'string', required: true, message: '请选择日期', trigger: 'blur'}
                    ],
                    notifyPerson: [
                        {type: 'array', required: true, message: '请至少选择一个通知人员', trigger: 'change'}
                    ],
                    reason: [
                        {required: true, message: '请填写请假原因', trigger: 'blur'},
                        {min: 1, max: 60, message: '长度在 1 到 60 个字符', trigger: 'blur'}
                    ],
                    approver: [
                        {required: true, message: '请选择审批人员', trigger: 'change'}
                    ],
                },
                rules2: {
                    address: [
                        {required: true, message: '请输入出差地址', trigger: 'blur'},
                        {min: 1, max: 25, message: '长度在 1 到 25 个字符', trigger: 'blur'}
                    ],
                    days: [
                        {required: true, message: '请输入请假天数', trigger: 'blur'},
                        {type: 'number', message: '天数必须为数字值'}
                    ],
                    fee: [
                        {required: true, message: '请输入预算费用', trigger: 'blur'},
                        {type: 'number', message: '费用必须为数字值'}
                    ],
                    type: [
                        {required: true, message: '请选择请假类型', trigger: 'change'}
                    ],
                    beginDate: [
                        {type: 'string', required: true, message: '请选择日期', trigger: 'blur'}
                    ],
                    notifyPerson: [
                        {type: 'array', required: true, message: '请至少选择一个通知人员', trigger: 'change'}
                    ],
                    reason: [
                        {required: true, message: '请填写请假原因', trigger: 'blur'},
                        {min: 1, max: 60, message: '长度在 1 到 60 个字符', trigger: 'blur'}
                    ],
                    approver: [
                        {required: true, message: '请选择审批人员', trigger: 'change'}
                    ],
                },
                rules3: {
                    loanReason: [
                        {required: true, message: '请输入借款原因', trigger: 'blur'},
                        {min: 1, max: 25, message: '长度在 1 到 50 个字符', trigger: 'blur'}
                    ],
                    loanAmount: [
                        {required: true, message: '请输入借款金额', trigger: 'blur'},
                        {type: 'number', message: '金额必须为数字值'}
                    ],
                    notifyPerson: [
                        {type: 'array', required: true, message: '请至少选择一个通知人员', trigger: 'change'}
                    ],
                    approver: [
                        {required: true, message: '请选择审批人员', trigger: 'change'}
                    ],
                },
                rules4: {
                    visitCustomer: [
                        {required: true, message: '请选择拜访客户类型', trigger: 'change'}
                    ],
                    bisitTime: [
                        {type: 'string', required: true, message: '请选择拜访时间', trigger: 'blur'}
                    ],
                    notifyPerson: [
                        {type: 'array', required: true, message: '请至少选择一个通知人员', trigger: 'change'}
                    ],
                    visitReason: [
                        {required: true, message: '请填写拜访原因', trigger: 'blur'},
                        {min: 1, max: 60, message: '长度在 1 到 60 个字符', trigger: 'blur'}
                    ],
                    approver: [
                        {required: true, message: '请选择审批人员', trigger: 'change'}
                    ],
                },
                rules5: {
                    emergency: [
                        {required: true, message: '请选择紧急状态类型', trigger: 'change'}
                    ],
                    requestContent: [
                        {required: true, message: '请填写请示内容', trigger: 'blur'},
                        {min: 1, max: 60, message: '长度在 1 到 60 个字符', trigger: 'blur'}
                    ],
                    notifyPerson: [
                        {type: 'array', required: true, message: '请至少选择一个通知人员', trigger: 'change'}
                    ],
                    approver: [
                        {required: true, message: '请选择审批人员', trigger: 'change'}
                    ],
                },
            }
        },
        mounted: function() {
            this.showpage();
            this.showDepartments();
            this.showOptions();
        },
        methods: {
            handleSizeChange: function (size) {
                console.log("Page Size Modified")
                console.log(size)
                this.pagesize = size;
                this.showpage();
            },
            handleCurrentChange: function (page) {
                console.log("The current page has been modified")
                console.log(page)
                this.currentPage = page;
                this.showpage();
            },
            showpage:function () {
                axios.get("/user/findAllUser/"+this.currentPage+"/"+this.pagesize).then(res => {
                    console.log(res.data.data)
                    this.userList = res.data.data.pageData;
                    this.total = res.data.data.total;
                })
            },
            showDepartments:function () {
                axios.get("/user/findAllDepartments").then(res => {
                    console.log(res.data)
                    this.options = res.data.data;
                })
            },
            showOptions:function () {
                axios.get("/user/findAllPositions").then(res => {
                    console.log(res.data)
                    this.options2 = res.data.data;
                })
            },
            search:function (params) {
                axios.get("/user/search",{
                    params: {
                        page: this.currentPage,
                        size: this.pagesize,
                        account: this.account,
                        did: this.did,
                        pid: this.pid,
                        sex: this.sex,
                        birthday: this.birthday
                    }}).then(res => {
                    console.log(res.data)
                    console.log(this.birthday)
                    this.userList = res.data.data.pageData;
                    this.total = res.data.data.total;
                })
            },
            handleSelectionChange: function(val) {
                this.multipleSelection = val;
                console.log(this.multipleSelection)
            },
            reset:function () {
                this.account = "";
                this.pid = "",
                this.did = "",
                this.sex = "",
                this.birthday = "";
            },
        }
    });
</script>

<style>

    .custom-container {
        justify-content: center;
        align-items: center;
        text-align: center;
        padding: 20px;
    }
    .custom-main {
        max-width: 1661px;
        margin: 0 auto;
        padding: 20px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
    }
    .custom-row {
        margin-bottom: 20px;
    }
    .custom-button {
        margin-right: 10px;
    }
    .custom-upload,
    .custom-export,
    .custom-popover,
    .custom-list {
        display: inline-block;
        vertical-align: middle;
    }
    .custom-popover .el-button {
        margin-left: 20px;
    }
    .el-table {
        margin-bottom: 20px;
    }
    .el-pagination {
        margin-top: 20px;
    }


</style>
</html>

